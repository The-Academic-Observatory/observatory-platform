{#
Copyright 2020 Curtin University.
Authors: James Diprose, Richard Hosking
#}

SELECT
  id,
  name,
  country,
  country_code,
  region,
  subregion,
  coordinates,
  DATE(time_period, 12, 31) AS published_year,
  total_outputs,
  access_types.oa.total_outputs as num_oa_outputs,
  total_outputs - access_types.oa.total_outputs AS num_not_oa_outputs,
  access_types.green.total_outputs as num_green_outputs,
  access_types.gold.total_outputs as num_gold_outputs,
  access_types.hybrid.total_outputs as num_hybrid_outputs,
  access_types.bronze.total_outputs as num_bronze_outputs,
  access_types.green_only.total_outputs as num_green_only_outputs,
  access_types.gold_doaj.total_outputs as num_gold_doaj_outputs,
  access_types.oa.percent AS percent_oa,
  access_types.green.percent as percent_green,
  access_types.green_only.percent as green_only,
  access_types.gold.percent as  percent_gold,
  access_types.gold_doaj.percent as percent_gold_doaj,
  access_types.hybrid.percent as percent_hybrid,
  access_types.bronze.percent as percent_bronze,
  citations.mag.total_citations as total_citations,
  citations.mag.citations_per_output as citations_per_output,
  citations.mag.outputs_with_citations as outputs_with_citations,
  citations.mag.outputs_without_citations as outputs_without_citations,
  citations.mag.citations_per_cited_output as citations_per_cited_output
FROM
  `{{ project_id }}.{{ dataset_id }}.{{ table_name }}`
ORDER BY id, published_year ASC